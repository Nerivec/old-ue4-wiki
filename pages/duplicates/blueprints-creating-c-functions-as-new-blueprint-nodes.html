<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <link href="https://www.epicgames.com/tos"/>
  <title>
   Blueprints, Creating C++ Functions as new Blueprint Nodes - Old UE4 Wiki
  </title>
  <link href="../styles.css" rel="stylesheet"/>
 </head>
 <body>
  <nav id="top-nav">
   <a href="../index.html" title="Home">
    Home
   </a>
  </nav>
  <div class="mw-body" id="content" role="main">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    Blueprints, Creating C++ Functions as new Blueprint Nodes
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From Epic Wiki
    </div>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <div class="toc" id="toc">
       <div class="toctitle">
        <h2>
         Contents
        </h2>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Overview">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Overview
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-2">
         <a href="#BlueprintCallable">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           BlueprintCallable
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-3">
         <a href="#BlueprintPure">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           BlueprintPure
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#Static">
          <span class="tocnumber">
           4
          </span>
          <span class="toctext">
           Static
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-5">
           <a href="#Static_With_World_Context">
            <span class="tocnumber">
             4.1
            </span>
            <span class="toctext">
             Static With World Context
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-6">
         <a href="#Creating_Interface_for_BP_Users_To_Access_New_C.2B.2B_Systems">
          <span class="tocnumber">
           5
          </span>
          <span class="toctext">
           Creating Interface for BP Users To Access New C++ Systems
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-7">
         <a href="#Activating_your_new_Blueprint">
          <span class="tocnumber">
           6
          </span>
          <span class="toctext">
           Activating your new Blueprint
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-8">
         <a href="#The_Power_of_Blueprints">
          <span class="tocnumber">
           7
          </span>
          <span class="toctext">
           The Power of Blueprints
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-9">
         <a href="#Advanced_Display_.28How_to_Hide_Parameters.29">
          <span class="tocnumber">
           8
          </span>
          <span class="toctext">
           Advanced Display (How to Hide Parameters)
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-10">
         <a href="#Conclusion">
          <span class="tocnumber">
           9
          </span>
          <span class="toctext">
           Conclusion
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-11">
         <a href="#Advanced_C.2B.2B_Blueprints">
          <span class="tocnumber">
           10
          </span>
          <span class="toctext">
           Advanced C++ Blueprints
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-12">
           <a href="#Sequence">
            <span class="tocnumber">
             10.1
            </span>
            <span class="toctext">
             Sequence
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-13">
           <a href="#Copying_Core_Code">
            <span class="tocnumber">
             10.2
            </span>
            <span class="toctext">
             Copying Core Code
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-14">
           <a href="#Settings">
            <span class="tocnumber">
             10.3
            </span>
            <span class="toctext">
             Settings
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-15">
           <a href="#Returning_Data">
            <span class="tocnumber">
             10.4
            </span>
            <span class="toctext">
             Returning Data
            </span>
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </div>
      <h2>
       <span class="mw-headline" id="Overview">
        Overview
       </span>
      </h2>
      <p>
       <i>
        Original Author:
       </i>
       (
       )
      </p>
      <p>
       Dear Community,
      </p>
      <p>
       This is an explanation of the syntax for a C++ function that you want to also run from blueprints!
      </p>
      <h2>
       <span class="mw-headline" id="BlueprintCallable">
        BlueprintCallable
       </span>
      </h2>
      <p>
       A BlueprintCallable function will have execution pins so that you can chain your C++ functions together in UE4 Blueprints.
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cm">/** Activate Fancy New Project-Specific System Created in C++! */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">Category</span><span class="o">=</span><span class="s">"SunShine"</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">ActivateSunShine</span><span class="p">();</span>
</pre>
      </div>
      <p>
       <img alt="Sunshine.jpg" class="" height="303" src="../assets/blueprints-creating-c-functions-as-new-blueprint-nodes/0.jpg" width="439"/>
      </p>
      <h2>
       <span class="mw-headline" id="BlueprintPure">
        BlueprintPure
       </span>
      </h2>
      <p>
       A great efficiency for blueprint users is to be able to access data from your C++ system without having to run the exec chain through it. If a function does not modify the game state, which requires a certain ordering for the rest of Blueprint logic and game logic to occurr correctly, then you can use Blueprint pure!
      </p>
      <p>
       A simple test for BlueprintPure is to use it for
       <b>
        accessor functions
       </b>
       , which are not modifying any variable data at all.
      </p>
      <p>
       So if you are wondering if you can make a function BlueprintPure, just ask yourself.
      </p>
      <p>
       <b>
        "Is this function entirely just an accessor for data, or doing calculations which have no bearing on the rest of the game state?"
       </b>
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cm">/** What is the current Sun Shine Rotation? ! */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintPure</span><span class="p">,</span> <span class="n">Category</span><span class="o">=</span><span class="s">"SunShine"</span><span class="p">)</span>
<span class="n">FRotator</span> <span class="n">GetSunShineRotation</span><span class="p">();</span>
</pre>
      </div>
      <p>
       <img alt="Newbpnodes.jpg" class="" height="498" src="../assets/blueprints-creating-c-functions-as-new-blueprint-nodes/1.jpg" width="800"/>
      </p>
      <h2>
       <span class="mw-headline" id="Static">
        Static
       </span>
      </h2>
      <p>
       If your functionality is not for a specific actor, or the functionality relates to a specific actor class but does not use member variables, then you can make the function static so that the BP node will show up anywhere in any BP graph:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cm">/** Log sunshine status from any BP in your entire game code! */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">Category</span><span class="o">=</span><span class="s">"SunShine"</span><span class="p">)</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">LogSunShineStatus</span><span class="p">();</span>
</pre>
      </div>
      <h3>
       <span class="mw-headline" id="Static_With_World_Context">
        Static With World Context
       </span>
      </h3>
      <p>
       If you want to use a static BP node anywhere in the game code, but your C++ function wants to modify the state of the game world by creating objects or actors, or performing an action on any instanced data within the game world, then you can pass along a world context object which is an invisible input parameter:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cm">/** Make sure to save off the return value as a global variable in one of your BPs or else it will get garbage collected! */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">Category</span> <span class="o">=</span> <span class="s">"Victory BP Library"</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">WorldContext</span> <span class="o">=</span> <span class="s">"WorldContextObject"</span><span class="p">))</span>
<span class="k">static</span> <span class="n">UPrimitiveComponent</span><span class="o">*</span> <span class="n">CreatePrimitiveComponent</span><span class="p">(</span><span class="n">UObject</span><span class="o">*</span> <span class="n">WorldContextObject</span><span class="p">,</span> <span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UPrimitiveComponent</span><span class="o">&gt;</span> <span class="n">CompClass</span><span class="p">,</span> <span class="n">FName</span> <span class="n">Name</span><span class="p">,</span> <span class="n">FVector</span> <span class="n">Location</span><span class="p">,</span> <span class="n">FRotator</span> <span class="n">Rotation</span><span class="p">);</span>
</pre>
      </div>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">UPrimitiveComponent</span><span class="o">*</span> <span class="n">UVictoryBPFunctionLibrary</span><span class="o">::</span><span class="n">CreatePrimitiveComponent</span><span class="p">(</span>
        <span class="n">UObject</span><span class="o">*</span> <span class="n">WorldContextObject</span><span class="p">,</span> 
	<span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UPrimitiveComponent</span><span class="o">&gt;</span> <span class="n">CompClass</span><span class="p">,</span> 
	<span class="n">FName</span> <span class="n">Name</span><span class="p">,</span>
	<span class="n">FVector</span> <span class="n">Location</span><span class="p">,</span> 
	<span class="n">FRotator</span> <span class="n">Rotation</span>
<span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CompClass</span><span class="p">)</span> 
	<span class="p">{</span>
		<span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">//~~~~~~~~~~~~~~~~~</span>
	
	<span class="c1">//using a context object to get the world!</span>
        <span class="n">UWorld</span><span class="o">*</span> <span class="k">const</span> <span class="n">World</span> <span class="o">=</span> <span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetWorldFromContextObject</span><span class="p">(</span><span class="n">WorldContextObject</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">World</span><span class="p">)</span> 
	<span class="p">{</span>
		<span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">//~~~~~~~~~~~</span>
	 
	<span class="n">UPrimitiveComponent</span><span class="o">*</span> <span class="n">NewComp</span> <span class="o">=</span> <span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UPrimitiveComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">World</span><span class="p">,</span> <span class="n">Name</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">NewComp</span><span class="p">)</span> 
	<span class="p">{</span>
		<span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="c1">//~~~~~~~~~~~~~</span>
	 
	<span class="n">NewComp</span><span class="o">-&gt;</span><span class="n">SetWorldLocation</span><span class="p">(</span><span class="n">Location</span><span class="p">);</span>
	<span class="n">NewComp</span><span class="o">-&gt;</span><span class="n">SetWorldRotation</span><span class="p">(</span><span class="n">Rotation</span><span class="p">);</span>
	<span class="n">NewComp</span><span class="o">-&gt;</span><span class="n">RegisterComponentWithWorld</span><span class="p">(</span><span class="n">World</span><span class="p">);</span>
	
	<span class="k">return</span> <span class="n">NewComp</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      </div>
      <h2>
       <span class="mw-headline" id="Creating_Interface_for_BP_Users_To_Access_New_C.2B.2B_Systems">
        Creating Interface for BP Users To Access New C++ Systems
       </span>
      </h2>
      <p>
       This is how you can create the interface in c++ for blueprint users to access your C++ systems!
      </p>
      <p>
       You can write all the core code in c++, and then give the rest of your team the power to access, modify, and utilize your awesome new C++ system!
      </p>
      <h2>
       <span class="mw-headline" id="Activating_your_new_Blueprint">
        Activating your new Blueprint
       </span>
      </h2>
      <p>
       Just adding the code is not enough to have it show in the editor. You need to go to your main project and click on the Compile icon.
      </p>
      <p>
       <img alt="Compile.png" class="" height="97" src="../assets/blueprints-creating-c-functions-as-new-blueprint-nodes/2.png" width="178"/>
      </p>
      <p>
       After this you can just right-click in an empty spot in any graph window and type the name of the function, it will show up!
      </p>
      <p>
       If you don't see the function in the list be sure you have deactivated the "Context Sensitive" option.
      </p>
      <p>
       <img alt="Context sensitive.png" class="" height="169" src="../assets/blueprints-creating-c-functions-as-new-blueprint-nodes/3.png" width="485"/>
      </p>
      <h2>
       <span class="mw-headline" id="The_Power_of_Blueprints">
        The Power of Blueprints
       </span>
      </h2>
      <p>
       This for me is the real power of blueprints, you are giving your whole team the power of robust new C++ systems, and the ability to use these new systems with the graphical convenience and fast iteration times of blueprints.
      </p>
      <h2>
       <span class="mw-headline" id="Advanced_Display_.28How_to_Hide_Parameters.29">
        Advanced Display (How to Hide Parameters)
       </span>
      </h2>
      <p>
       How to make hidden parameters:
      </p>
      <p>
       If you want some parameters to only show if you click the arrow to expand the node (like with the UE4 print string node), then use this!
      </p>
      <p>
       Here 2 means parameter at index 2 in a list of the function parameters that starts with 0.
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">Category</span><span class="o">=</span><span class="s">"Fun"</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="n">AdvancedDisplay</span> <span class="o">=</span> <span class="s">"2"</span><span class="p">))</span>
<span class="kt">void</span> <span class="n">PerformFunAction</span><span class="p">(</span><span class="n">FString</span> <span class="n">Name</span><span class="p">,</span> <span class="n">int32</span> <span class="n">Count</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">DebugMode</span><span class="o">=</span><span class="nb">false</span><span class="p">);</span>
</pre>
      </div>
      <p>
       Advanced options should generally have a proper default value as the user may never expand the node to see what the other options are. That's why I am using DebugMode
       <b>
        =false
       </b>
      </p>
      <p>
       Enjoy!
      </p>
      <h2>
       <span class="mw-headline" id="Conclusion">
        Conclusion
       </span>
      </h2>
      <p>
       Now you know how to make new blueprint nodes!
      </p>
      <p>
       Enjoy!
      </p>
      <p>
       (
       )
      </p>
      <hr/>
      <h2>
       <span class="mw-headline" id="Advanced_C.2B.2B_Blueprints">
        Advanced C++ Blueprints
       </span>
      </h2>
      <p>
       This section is for those that wish to do more advanced blueprints like what are in the core engine.  Our incentive for doing this was to make a custom Session set of nodes.  We did this by copying the code from the core for the Create Session blueprint node and then changing it.
      </p>
      <p>
       Of course, you need to decide if making a custom node set is even a good idea.  For example a custom session node set is available at
       <a class="external free" href="https://forums.unrealengine.com/showthread.php?69901-Advanced-Sessions-Plugin" rel="nofollow">
        https://forums.unrealengine.com/showthread.php?69901-Advanced-Sessions-Plugin
       </a>
       and might be more suitable for your purposes than making a custom session your self.
      </p>
      <p>
       (You do have a copy of the core code from GitHub, right?
       <a class="external free" href="https://www.unrealengine.com/ue4-on-github" rel="nofollow">
        https://www.unrealengine.com/ue4-on-github
       </a>
       )
      </p>
      <p>
       If you want to find where blueprint nodes are implemented in the core code you look for "CallbackProxy" and "UOnlineBlueprintCallProxyBase".  If looking for the blueprint C++ implementation for CreateSession it is in UnrealEngine/Engine/Source/Runtime/Online/OnlineSubsystemUtils/Classes/CreateSessionCallbackProxy.h
      </p>
      <dl>
       <dd>
        Also BlueprintAsyncActionBase is important.  If you are curious about the core blueprint node code, try looking in UnrealEngine/Engine/Source/Runtime/Engine/Classes/Kismet/ and there are the files for things like KismetMathLibrary and the Sqrt blueprint node. Most of those are simple static blueprint calls. I like the headings on these as they show how to do aliases for searching and such...
       </dd>
       <dd>
       </dd>
       <dd>
        /* Returns square root of A*/
       </dd>
       <dd>
       </dd>
       <dd>
        UFUNCTION(BlueprintPure, Category="Math|Float", meta=(Keywords = "square root", CompactNodeTitle = "SQRT"))
       </dd>
       <dd>
       </dd>
       <dd>
        static float Sqrt(float A);
       </dd>
      </dl>
      <p>
       The previous section explained how to do static function single call nodes.  Here we describe how to customize nodes that have multiple outputs (like Success and Fail) and wait for results.  Network operations and disk read operations can take time and you don't want to stop the game to wait.  So instead you start the operation (e.g. the Online subsystem CreateSession call) and then return immediately.  Some while later the action is done or fails and you get a Callback to a function saying "hey, it's done" and then your blueprint node can return results and continue on the to the next blueprint node.
      </p>
      <ul class="gallery mw-gallery-traditional">
       <li class="gallerybox" style="width: 155px">
        <div style="width: 155px">
         <div class="thumb" style="width: 150px;">
          <div style="margin:39.5px auto;">
           <img alt="" class="" height="71" src="../assets/blueprints-creating-c-functions-as-new-blueprint-nodes/4.png" width="120"/>
          </div>
         </div>
         <div class="gallerytext">
          <p>
           A Node that waits...
          </p>
         </div>
        </div>
       </li>
      </ul>
      <h3>
       <span class="mw-headline" id="Sequence">
        Sequence
       </span>
      </h3>
      <p>
       The sequence in the core CreateSession code is like this...
      </p>
      <ul>
       <li>
        The node gets created when the blueprint loads into memory. UCreateSessionCallbackProxy::UCreateSessionCallbackProxy(const FObjectInitializer&amp; ObjectInitializer)
       </li>
       <li>
        Some time later your blueprint hits the node with a 'bead' flowing along the white line, and calls the function: CreateSession(UObject* WorldContextObject, class APlayerController* PlayerController, int32 PublicConnections, bool bUseLAN)
       </li>
       <li>
        Then the Activate function gets called, and kicks off the session creation. (In our case this is a call to the Online subsystem, which calls the Steam session creation.)
       </li>
       <li>
        Some time later Steam responds and OnCreateCompleted gets called, which starts the session
       </li>
       <li>
        Some time later again the start gets done and OnStartCompleted gets called.
       </li>
       <li>
        OnStartCompleted then decides if you had success of failure and any other data to put on the outputs of the blueprint node. If all is ok then we call OnSuccess.Broadcast(); to "fire a bead" out on the Success white line in the blueprint.
       </li>
      </ul>
      <p>
       Luckily all the little details all already work in the core code so you don't have to do much.
      </p>
      <h3>
       <span class="mw-headline" id="Copying_Core_Code">
        Copying Core Code
       </span>
      </h3>
      <p>
       When you copy the code out of the core code, you have to do some renaming of the .cpp and .h files and some class names..  We changed the name from CreateSession to CreateCustomSession.  That change is both to the file names, and in the files to the class names. Note that the core engine divides files by Public, Private, and Classes so you have to look around a bit.
      </p>
      <p>
       Another problem we found was that FOnlineSubsystemBPCallHelper is internal and private so you can't get at it (it is in UnrealEngine/Engine/Source/Runtime/Online/OnlineSubsystemUtils/Private/OnlineSubsystemUtilsPrivatePCH.h)
      </p>
      <p>
       So we copied that into our project and renamed it so we can play with it.
      </p>
      <h3>
       <span class="mw-headline" id="Settings">
        Settings
       </span>
      </h3>
      <p>
       The whole purpose of making our custom session was to add a password, currentMap and settable lobby name and some other settings.
Settings in a session are a key-value pair, such as "password":"supersecret" and always have a FName key, and the value can be string, integer and several other things.  We made a SetCustomSessionSetting and a GetCustomSessionSetting blueprint nodes.
      </p>
      <p>
       In CreateSessionCallbackProxy the code looks like Settings.NumPublicConnections = NumPublicConnections; which then is converted to session setting set calls.  We want to add our own so we do calls like Settings.Set(FName("password"), ourpassword, EOnlineDataAdvertisementType::ViaOnlineServer);  That ViaOnlineServer is very important.  It means that the session setting will get sent to all clients looking at the session.
      </p>
      <h3>
       <span class="mw-headline" id="Returning_Data">
        Returning Data
       </span>
      </h3>
      <p>
       Sometimes the blueprint node needs to have output, like FindSessions has an array of sessions it found.
      </p>
      <p>
       You declare the delegate like this...
      </p>
      <p>
       DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FBlueprintFindSessionsResultDelegate, const TArray&lt;FBlueprintSessionResult&gt;&amp;, Results);
      </p>
      <p>
       and then...
      </p>
      <p>
       In UnrealEngine/Engine/Source/Runtime/Online/OnlineSubsystemUtils/Private/FindSessionsCallbackProxy.cpp
you will see that OnComplete has return values like
       <code>
       </code>
      </p>
      <code>
       <pre>	if (bSuccess &amp;&amp; SearchObject.IsValid())
	{
		for (auto&amp; ResultÂ : SearchObject-&gt;SearchResults)
		{
			FBlueprintSessionResult BPResult;
			BPResult.OnlineResult = Result;
			Results.Add(BPResult);
		}

		OnSuccess.Broadcast(Results);
	}
	else
	{
		OnFailure.Broadcast(Results);
	}
</pre>
      </code>
      <p>
       <code>
       </code>
      </p>
      <p>
       <br/>
       (
     ) 20:04, 7 June 2016 (UTC) (Advanced C++ Blueprints Section)
      </p>
      <p>
       (
       ) (Initial Article and Basic Blueprints Section)
      </p>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
 </body>
</html>