<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <link href="https://www.epicgames.com/tos"/>
  <title>
   FSM - Old UE4 Wiki
  </title>
  <link href="../styles.css" rel="stylesheet"/>
 </head>
 <body>
  <nav id="top-nav">
   <a href="../index.html" title="Home">
    Home
   </a>
  </nav>
  <div class="mw-body" id="content" role="main">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    FSM
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From Epic Wiki
    </div>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <p>
       <br/>
      </p>
      <table class="wikitable sortable" style="float: right;">
       <tbody>
        <tr>
         <td>
          Name
         </td>
         <td>
          Finite State Machine Plugin
         </td>
        </tr>
        <tr>
         <td>
          Category
         </td>
         <td>
          Programming
         </td>
        </tr>
        <tr>
         <td>
          Author
         </td>
         <td>
          Bruno Xavier Leite
         </td>
        </tr>
        <tr>
         <td>
          Version
         </td>
         <td>
          1.0
         </td>
        </tr>
        <tr>
         <td>
          UE4 Build
         </td>
         <td>
          4.12+
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       <br/>
      </p>
      <div class="toc" id="toc">
       <div class="toctitle">
        <h2>
         Contents
        </h2>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Overview">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Overview
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-2">
         <a href="#Requirements">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           Requirements
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-3">
         <a href="#Technical_Details">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           Technical Details
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#FSM_Component">
          <span class="tocnumber">
           4
          </span>
          <span class="toctext">
           FSM Component
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-5">
         <a href="#FSM:_Blueprint_Graph">
          <span class="tocnumber">
           5
          </span>
          <span class="toctext">
           FSM: Blueprint Graph
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-6">
           <a href="#On_Begin_State">
            <span class="tocnumber">
             5.1
            </span>
            <span class="toctext">
             On Begin State
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-7">
           <a href="#On_Update_State">
            <span class="tocnumber">
             5.2
            </span>
            <span class="toctext">
             On Update State
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-8">
           <a href="#On_Exit_State">
            <span class="tocnumber">
             5.3
            </span>
            <span class="toctext">
             On Exit State
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-9">
         <a href="#FSM:_Animation_Graph">
          <span class="tocnumber">
           6
          </span>
          <span class="toctext">
           FSM: Animation Graph
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-10">
         <a href="#FSM:_Behavior_Trees">
          <span class="tocnumber">
           7
          </span>
          <span class="toctext">
           FSM: Behavior Trees
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-11">
         <a href="#FSM:_.28C.2B.2B.29_Native_API">
          <span class="tocnumber">
           8
          </span>
          <span class="toctext">
           FSM: (C++) Native API
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-12">
         <a href="#Conclusion">
          <span class="tocnumber">
           9
          </span>
          <span class="toctext">
           Conclusion
          </span>
         </a>
        </li>
       </ul>
      </div>
      <h2>
       <span class="mw-headline" id="Overview">
        Overview
       </span>
      </h2>
      <p>
       Quick user guide on how to use the UFSM Plugin for Unreal Engine 4.
This guide assumes you have familiarity with Unreal Engine tools and subsystems; including Blueprints, AnimGraphs, BehaviorTrees, etc.
       <br/>
      </p>
      <p>
       UFSM is a simple, yet powerful, Finite State Machine system which allows you to manipulate Actor States through Animation Graph’s State Machines, Behavior Tree Tasks, Blueprint Graphs, or C++ Native Code.
       <br/>
       Finite State Machines allows for more logic encapsulation and cleaner code architecture in general, drawing systems design and debugging easier on the long run.
       <br/>
       You will be able to get the plugin from Epic Games, in Launcher or Marketplace webpage, and install directly to your Unreal Engine directory. No other installation steps are required.
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="Requirements">
        Requirements
       </span>
      </h2>
      <p>
       Theoretically, this system could work with any Unreal Engine 4 version, but is developed and maintained only for 4.12 version and beyond.
       <br/>
       Building the engine from source is not required, you can install on both GitHub or Launcher engine versions.
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="Technical_Details">
        Technical Details
       </span>
      </h2>
      <p>
       Within the UFSM Plugin you have some new feature tools to work with:
       <br/>
      </p>
      <ul>
       <li>
        Blueprintable Finite State Machine System.
       </li>
       <li>
        Blueprint Actor Component Based.
       </li>
       <li>
        Event-Based Tasks/Actions can be Broadcasted.
       </li>
       <li>
        Supports Enumerators as State ID.
       </li>
       <li>
        Supports Runtime State-Machine Creation/Deletion.
       </li>
       <li>
        Supports Runtime State-Machine Event Bindings.
       </li>
       <li>
        State Machines can Tick and Track Update Time.
       </li>
       <li>
        FSM Properties can be Replicated.
       </li>
       <li>
        Get/Set States from C++, Blueprints, Animation Graphs, Behavior Trees.
       </li>
      </ul>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="FSM_Component">
        FSM Component
       </span>
      </h2>
      <p>
       <img alt="FSM Component.jpg" class="" height="808" src="../assets/fsm/0.jpg" width="600"/>
      </p>
      <p>
       Once you have the UFSM Plugin installed and UEditor restarted, you now have access to a new Custom Actor Component: the 'Finite State Machine' Component.
       <br/>
       This component can be attached to any Actor in your Map, but for some utilities an AI Controller or a Skeletal Character are required. In case it's just a Pawn or plain Actor, you can manipulate its States through Blueprint Graphs or C++ Code, but not Behavior Trees or Animation Blueprints.
       <br/>
       For all Actors you wish to implement a Finite State Machine, each of them must have at least one of this Component.
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="FSM:_Blueprint_Graph">
        FSM: Blueprint Graph
       </span>
      </h2>
      <p>
       <img alt="FSM BP1.jpg" class="" height="832" src="../assets/fsm/1.jpg" width="581"/>
      </p>
      <p>
       When you add a FSM Component to your Actor/Pawn/Character Blueprint, a new set of Events are generated for it. You use those Events to query, change, or react to State Machine's changes in your Blueprint when the game is running.
      </p>
      <p>
       <img alt="FSM BP2.jpg" class="" height="841" src="../assets/fsm/2.jpg" width="1662"/>
      </p>
      <h3>
       <span class="mw-headline" id="On_Begin_State">
        On Begin State
       </span>
      </h3>
      <p>
       <img alt="FSM OnBegin.jpg" class="" height="215" src="../assets/fsm/3.jpg" width="340"/>
      </p>
      <p>
       This Blueprintable Event fires in your Actor every time a FSM State enters active mode. From it you are able to query which State ID has just entered active mode and its Name. From there is quite simple to compare its ID with an Enumerator or fire another Event based on which active State Name is set.
      </p>
      <p>
       <b>
        NOTE
       </b>
       : If you have "Blueprint Auto-Flow FSM" option active (enabled by default on latest plugin releases) then this Node is no longer required, all of your State functions will be called automatically by their owner State when such State becomes active in your FSM Component.
      </p>
      <h3>
       <span class="mw-headline" id="On_Update_State">
        On Update State
       </span>
      </h3>
      <p>
       <img alt="FSM OnUpdate.jpg" class="" height="240" src="../assets/fsm/4.jpg" width="345"/>
      </p>
      <p>
       This Blueprintable Event fires in your Actor every time the actual active FSM State ticks, every frame. From it you can query which State ID is ticking, its name and also for how long have it be updating in seconds. Keeping track of the Update Time is quite useful in Finite State Machines, you can architecture other Functions or Events to fire once an State has been running after X seconds.
      </p>
      <p>
       <b>
        NOTE
       </b>
       : If you have "Blueprint Auto-Flow FSM" option active (enabled by default on latest plugin releases) then this Node is no longer required, all of your State functions will be called automatically by their owner State when such State becomes active in your FSM Component.
      </p>
      <h3>
       <span class="mw-headline" id="On_Exit_State">
        On Exit State
       </span>
      </h3>
      <p>
       <img alt="FSM OnExit.jpg" class="" height="205" src="../assets/fsm/5.jpg" width="320"/>
      </p>
      <p>
       This Blueprintable Event fires in your Actor every time the actual active FSM State is exiting active mode. From it you can query which State ID just transitioned to inactive mode and its Name.
      </p>
      <p>
       <b>
        NOTE
       </b>
       : If you have "Blueprint Auto-Flow FSM" option active (enabled by default on latest plugin releases) then this Node is no longer required, all of your State functions will be called automatically by their owner State when such State becomes active in your FSM Component.
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="FSM:_Animation_Graph">
        FSM: Animation Graph
       </span>
      </h2>
      <p>
       <img alt="FSM Anim1.png" class="" height="1080" src="../assets/fsm/6.png" width="1920"/>
      </p>
      <p>
       If you so wish, you can make a FSM Component reflect a State Machine inside an Animation Blueprint. This however applies only to Skeletal Actors because Animation Blueprint is required.
       <br/>
       Animation Graph’s State Machine Editor is great to setup a FSM and keep a complete visual reference of how your FSM behaves. To do so, you create an Animation Blueprint as usual for your Skeletal Asset, but instead of choosing AnimInstance as Parent Class, pick ‘StateMachineABP’:
      </p>
      <p>
       <img alt="FSM Anim2.jpg" class="" height="1098" src="../assets/fsm/7.jpg" width="613"/>
      </p>
      <p>
       Within an Animation Blueprint you can add multiple State Machines, so you must tell the Animation Blueprint which is the Name of the FSM Component you want it to link then tell it the Name of which of its own State Machines you want to 'export' to the FSM Component. Once you setup target Name fields, and 'Override FSM' option is enabled, the Animation Blueprint will on Game startup tell the FSM to refresh all of its States reflecting the States you've created inside the Animation Graph's State Machine. Note that 'Target ASM' refers to Animation State Machine and 'Target FSM' refers to the FSM Component you have attached to your Actor.
       <br/>
       The Graph setup is that simple, simply make sure you have input both FSM and ASM Names correctly then the linkage is done.
      </p>
      <p>
       <img alt="FSM Anim3.jpg" class="" height="393" src="../assets/fsm/8.jpg" width="1345"/>
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="FSM:_Behavior_Trees">
        FSM: Behavior Trees
       </span>
      </h2>
      <p>
       <img alt="FSM BT1.png" class="" height="1080" src="../assets/fsm/9.png" width="1920"/>
      </p>
      <p>
       You can also manipulate FSM States within an AI Controller’s Behavior Tree Board. Using the custom Task nodes: ‘Add State’, ‘Set State’, ‘Check State’, and ‘Remove State’, you can easily make your AI dictate FSM Component’s States based on AI decisions. This is also an awesome way to easily make your AI react to changes within an Animation Blueprint’s State or react to changes within a Character Blueprint’s Events.
       <br/>
       It's possible to organize your Tree to manipulate the whole FSM Component or restrict it to react to or change only specific FSM States, you have a lot of freedom on how you Add, Set, Check for, or Remove States. You can even use multiple Behavior Trees to dictate different FSM State routes.
      </p>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="FSM:_.28C.2B.2B.29_Native_API">
        FSM: (C++) Native API
       </span>
      </h2>
      <p>
       <img alt="FSM CPP1.png" class="" height="1080" src="../assets/fsm/10.png" width="1920"/>
      </p>
      <p>
       Of course if you wish so, you can build your FSM Component and its States from C++ Code and still later be able to interact with it through Behavior Trees, Animation Blueprints, Blueprints, etc. An additional power you have from Native Code is you can bind Functions to FSM States, directly. That means from C++ you don't have to query for State ID to call a Function like in Blueprints, you can bind Functions to a State object directly!
      </p>
      <p>
       Here's a straightforward example of the creation of a Finite State Machine Component within an Actor's Constructor:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="k">auto</span> <span class="n">StateMachine</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStateMachineComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"StateMachine"</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">IsValidLowLevel</span><span class="p">())</span> <span class="p">{</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Idle"</span><span class="p">));</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Stand"</span><span class="p">));</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Run"</span><span class="p">));</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Push"</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      </div>
      <p>
       And binding Functions to a State and each of its Events; these functions will be executed every time the State is active:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnBeginState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">OnBeginIdle</span><span class="p">);</span>
<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnUpdateState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">OnUpdateIdle</span><span class="p">);</span>
<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnExitState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">OnExitIdle</span><span class="p">);</span>
</pre>
      </div>
      <p>
       As you can see, you can bind a new Function to States during runtime, or unbind Functions from it while the game is running as well. You can also easily manipulate States by State Name, State IDs or even directly compare against Enumerator types directly by code, with very simple lines, such as:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetStateID</span><span class="p">())</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="c1">/////////////////// Idle:</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">Axis</span> <span class="o">&gt;=</span> <span class="mf">0.8f</span><span class="p">)</span> <span class="p">{</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetState</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">"Push"</span><span class="p">));}</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetState</span><span class="p">((</span><span class="n">uint8</span><span class="p">)</span><span class="n">EStates</span><span class="o">::</span><span class="n">Idle</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       <br/>
       Example Character Controller class, setup to use a FSM Component (UFSM 1.6.0+ update), and how to subscribe to State change events automatically fired by the UStateMachineComponent object:
      </p>
      <p>
       A Simple Character .H:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">"UFSM.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"GameFramework/Character.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"FSM_NativeCharacter.generated.h"</span><span class="cp"></span>

<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">MYGAMEAPI</span> <span class="nl">AFSM_NativeCharacter</span> <span class="p">:</span> <span class="k">public</span> <span class="n">ACharacter</span><span class="p">,</span> <span class="k">public</span> <span class="n">IFSMInterface</span>
<span class="p">{</span>
	<span class="n">GENERATED_BODY</span><span class="p">()</span>

<span class="k">public</span><span class="o">:</span>
	<span class="c1">// Sets default values for this character's properties</span>
	<span class="n">AFSM_NativeCharacter</span><span class="p">();</span>

	<span class="n">UPROPERTY</span><span class="p">()</span>
	<span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">StateMachine</span><span class="p">;</span>

<span class="k">protected</span><span class="o">:</span>
	<span class="c1">// Called when the game starts or when spawned</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">BeginPlay</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>	
	<span class="c1">// Called every frame</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">Tick</span><span class="p">(</span><span class="kt">float</span> <span class="n">DeltaTime</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

	<span class="c1">// Called to bind functionality to input</span>
	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span> <span class="nc">UInputComponent</span><span class="o">*</span> <span class="n">PlayerInputComponent</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

	<span class="n">UFUNCTION</span><span class="p">()</span>
	<span class="kt">void</span> <span class="n">BindBeginIdle</span><span class="p">();</span>
	<span class="n">UFUNCTION</span><span class="p">()</span>
	<span class="kt">void</span> <span class="n">BindUpdateIdle</span><span class="p">();</span>
	<span class="n">UFUNCTION</span><span class="p">()</span>
	<span class="kt">void</span> <span class="n">BindExitIdle</span><span class="p">();</span>

<span class="k">public</span><span class="o">:</span>
	<span class="c1">/// FSM: Initialization Interface.</span>
	<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="s">"FSM"</span><span class="p">,</span> <span class="n">BlueprintNativeEvent</span><span class="p">,</span> <span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisplayName</span> <span class="o">=</span> <span class="s">"FSM: On Initialized"</span><span class="p">,</span> <span class="n">Keywords</span> <span class="o">=</span> <span class="s">"FSM Initialization Interface"</span><span class="p">))</span>
	<span class="kt">void</span> <span class="n">OnInitializedFSM</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">);</span>
	<span class="c1">//</span>
	<span class="c1">/// FSM: On Any 'On Begin' Event.</span>
	<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="s">"FSM"</span><span class="p">,</span> <span class="n">BlueprintNativeEvent</span><span class="p">,</span> <span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisplayName</span> <span class="o">=</span> <span class="s">"FSM: On Any Begin"</span><span class="p">,</span> <span class="n">Keywords</span> <span class="o">=</span> <span class="s">"FSM Begin Event"</span><span class="p">))</span>
	<span class="kt">void</span> <span class="n">OnAnyBeginState</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithPrevious</span><span class="p">);</span>
	<span class="c1">//</span>
	<span class="c1">/// FSM: On Any 'On Update' Event.</span>
	<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="s">"FSM"</span><span class="p">,</span> <span class="n">BlueprintNativeEvent</span><span class="p">,</span> <span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisplayName</span> <span class="o">=</span> <span class="s">"FSM: On Any Update"</span><span class="p">,</span> <span class="n">Keywords</span> <span class="o">=</span> <span class="s">"FSM Update Event"</span><span class="p">))</span>
	<span class="kt">void</span> <span class="n">OnAnyUpdateState</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">WithStateTime</span><span class="p">);</span>
	<span class="c1">//</span>
	<span class="c1">/// FSM: On Any 'On Exit' Event.</span>
	<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">Category</span> <span class="o">=</span> <span class="s">"FSM"</span><span class="p">,</span> <span class="n">BlueprintNativeEvent</span><span class="p">,</span> <span class="n">BlueprintCallable</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisplayName</span> <span class="o">=</span> <span class="s">"FSM: On Any Exit"</span><span class="p">,</span> <span class="n">Keywords</span> <span class="o">=</span> <span class="s">"FSM Exit Event"</span><span class="p">))</span>
	<span class="kt">void</span> <span class="n">OnAnyExitState</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">);</span>
	
<span class="p">};</span>
</pre>
      </div>
      <p>
       <br/>
       A Simple Character .CPP:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="cp">#include</span> <span class="cpf">"FSM_NativeCharacter.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"Unreal_FSM.h"</span><span class="cp"></span>

<span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">AFSM_NativeCharacter</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">PrimaryActorTick</span><span class="p">.</span><span class="n">bCanEverTick</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">StateMachine</span> <span class="o">=</span> <span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UStateMachineComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"StateMachine"</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">IsValidLowLevelFast</span><span class="p">())</span> <span class="p">{</span>
	
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Idle"</span><span class="p">));</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Stand"</span><span class="p">));</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Run"</span><span class="p">));</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">AddState</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">FName</span><span class="p">(</span><span class="s">"Push"</span><span class="p">));</span>

		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetActive</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">bAutoActivate</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">Debug</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
	
	<span class="n">FSM_Transition</span> <span class="n">Trans</span><span class="p">;</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetStateID</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Trans</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span> <span class="n">DeltaTime</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="n">DeltaTime</span><span class="p">);</span>
	
	<span class="n">FSM_Transition</span> <span class="n">Trans</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetCurrentStateID</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetLastStateID</span><span class="p">()))</span> <span class="p">{</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetStateID</span><span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetCurrentStateID</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Trans</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">SetStateID</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Trans</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">UInputComponent</span><span class="o">*</span> <span class="n">PlayerInputComponent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Super</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">PlayerInputComponent</span><span class="p">);</span>

<span class="p">}</span>



<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">OnInitializedFSM_Implementation</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Context</span> <span class="o">!=</span> <span class="n">StateMachine</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
	<span class="c1">//</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnBeginState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindBeginIdle</span><span class="p">);</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnUpdateState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindUpdateIdle</span><span class="p">);</span>
	<span class="n">StateMachine</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">OnExitState</span><span class="p">.</span><span class="n">AddDynamic</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="o">&amp;</span><span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindExitIdle</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">OnAnyBeginState_Implementation</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithPrevious</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">OnAnyUpdateState_Implementation</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">WithStateTime</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">OnAnyExitState_Implementation</span><span class="p">(</span><span class="k">const</span> <span class="n">UStateMachineComponent</span><span class="o">*</span> <span class="n">Context</span><span class="p">,</span> <span class="k">const</span> <span class="n">FName</span> <span class="n">WithStateName</span><span class="p">,</span> <span class="k">const</span> <span class="n">uint8</span> <span class="n">WithStateID</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindBeginIdle</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="n">Warning</span><span class="p">,</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"{FSM}:: %s"</span><span class="p">),</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"BINDED Begin!"</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindUpdateIdle</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="n">Warning</span><span class="p">,</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"{FSM}:: %s"</span><span class="p">),</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"BINDED Update!"</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">AFSM_NativeCharacter</span><span class="o">::</span><span class="n">BindExitIdle</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="n">Warning</span><span class="p">,</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"{FSM}:: %s"</span><span class="p">),</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"BINDED Exit!"</span><span class="p">));</span>
<span class="p">}</span>
</pre>
      </div>
      <p>
       Note that you have to make the plugin visible to your Game's module in order to make its Components and header files usable in your C++ code. For that you must add a reference of UFSM module to your Build.cs file:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"UFSM"</span> <span class="p">});</span>
</pre>
      </div>
      <p>
       <br/>
      </p>
      <h2>
       <span class="mw-headline" id="Conclusion">
        Conclusion
       </span>
      </h2>
      <p>
       With a little bit of imagination, this little tool provides unlimited possibilities! Thanks to the awesome environment provided by Epic Games and their Unreal Engine 4.
If you’re used to work with State Machines, such as Unity PlayMaker, you’ll quickly adapt to the workflow proposed by this Plugin; You can really encapsulate all code logic into Finite State rules. If you never tried FSMs before to build game logic, it will set you free of infinite spaghetti piles of code on the long run, give it a try!
      </p>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
 </body>
</html>